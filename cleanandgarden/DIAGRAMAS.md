# ğŸ—ºï¸ DIAGRAMA VISUAL DEL PROYECTO - CLEAN & GARDEN

**Mapas mentales y diagramas para entender la estructura**

---

## ğŸ“Š Relaciones de Base de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ROL        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id            â”‚
â”‚ â€¢ codigo        â”‚
â”‚ â€¢ nombre        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO                                  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)                                                   â”‚
â”‚ â€¢ nombre, apellido                                          â”‚
â”‚ â€¢ email (UNIQUE)                                            â”‚
â”‚ â€¢ telefono                                                  â”‚
â”‚ â€¢ contrasena_hash                                           â”‚
â”‚ â€¢ activo (bool) - Requiere confirmar email                â”‚
â”‚ â€¢ rol_id (FK)                                               â”‚
â”‚ â€¢ fecha_creacion, fecha_actualizacion                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚
         â”‚ 1:N            â”‚ 1:N            â”‚ 1:N
         â”‚                â”‚                â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  CITA   â”‚    â”‚ JARDIN    â”‚    â”‚ MENSAJE   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:1
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PAGO    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:1
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ VISITA   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUARIO NUEVO   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 1. POST /register
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend:                             â”‚
â”‚ â€¢ Valida email Ãºnico                 â”‚
â”‚ â€¢ Hash contraseÃ±a con bcrypt         â”‚
â”‚ â€¢ Genera token confirmaciÃ³n          â”‚
â”‚ â€¢ Crea usuario con activo=false      â”‚
â”‚ â€¢ EnvÃ­a email con token              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Email recibido
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario abre link confirmaciÃ³n    â”‚
â”‚ GET /confirm-email?token=xxx      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 2. Backend valida token
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Token vÃ¡lido?          â”‚
â”‚ â€¢ No expirado?           â”‚
â”‚ â€¢ Usuario existe?        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
      â”Œâ”€â”€â”€â”´â”€â”€â”€â”
      â”‚       â”‚
   SÃ â”‚       â”‚ NO
      â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Error
â”‚ SET      â”‚  400
â”‚ activo   â”‚
â”‚ = true   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Usuario puede hacer login
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /login             â”‚
â”‚  â€¢ email, password       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Backend verifica:
         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
     â”‚Existe?â”‚ NO â†’ Error 401
     â””â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚ SÃ
         â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ContraseÃ±a?â”‚ NO â†’ Error 401
     â”‚correcta?  â”‚
     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ SÃ
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Genera JWT vÃ¡lido 1h  â”‚
    â”‚ Guardado en cookie    â”‚
    â”‚ httpOnly = true       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… USUARIO AUTENTICADO     â”‚
â”‚ â€¢ Cookie con token         â”‚
â”‚ â€¢ Acceso a rutas protegidasâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Reserva de Cita

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIENTE AUTENTICADO EN /chat        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 1. Ver servicios disponibles
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ GET /servicio    â”‚
     â”‚ Responde lista   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 2. Selecciona: Servicio + Jardin + Fecha
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ POST /cita                       â”‚
     â”‚ {                                â”‚
     â”‚   cliente_id,                    â”‚
     â”‚   servicio_id,                   â”‚
     â”‚   jardin_id,                     â”‚
     â”‚   fecha_hora,                    â”‚
     â”‚   duracion_minutos               â”‚
     â”‚ }                                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Backend:
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ â€¢ Valida datos           â”‚
     â”‚ â€¢ Crea cita              â”‚
     â”‚ â€¢ estado = "pendiente"   â”‚
     â”‚ â€¢ Busca tÃ©cnico asignado â”‚
     â”‚ â€¢ Notifica al tÃ©cnico    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 3. TÃ‰CNICO RECIBE NOTIFICACIÃ“N
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ TÃ©cnico ve cita          â”‚
     â”‚ Puede aceptar o rechazar â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
          â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
          â”‚        â”‚
       Acepta  Rechaza
          â”‚        â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”   â””â”€â–º Error â†’ Cliente ve "Rechazada"
    â”‚ PUT    â”‚
    â”‚ /cita  â”‚
    â”‚ estado=â”‚
    â”‚confirm â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚
         â”‚ 4. CLIENTE VE CONFIRMACIÃ“N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… CITA CONFIRMADA                   â”‚
â”‚ â€¢ Cliente puede pagar                â”‚
â”‚ â€¢ TÃ©cnico ve detalles                â”‚
â”‚ â€¢ Se envÃ­a recordatorio 24h antes    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ Flujo de Pago

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIENTE EN CITA CONFIRMADA           â”‚
â”‚ Debe pagar antes del servicio        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Selecciona mÃ©todo
         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ FLOW        â”‚ TRANSFERENCIAâ”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚
           â”‚              â”‚ Sube comprobante
           â”‚              â–¼
           â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚        â”‚ POST /pago       â”‚
           â”‚        â”‚ metodo:          â”‚
           â”‚        â”‚ transferencia    â”‚
           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚ 3. Admin recibe
           â”‚                 â–¼
           â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚        â”‚ Admin dashboard  â”‚
           â”‚        â”‚ Valida tranfer   â”‚
           â”‚        â”‚ PUT /pago/validate
           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â–¼
           â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚        â”‚ Estado aprobado  â”‚
           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 2. POST /pago (flow)
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend genera orden Flowâ”‚
    â”‚ Usuario redirigido a     â”‚
    â”‚ Pasarela Flow            â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Usuario paga en Flow
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Flow procesa pago        â”‚
    â”‚ Notifica a backend       â”‚
    â”‚ POST /webhook/flow       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend actualiza estado â”‚
    â”‚ pago.estado = aprobado   â”‚
    â”‚ Notifica al cliente      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… PAGO APROBADO                     â”‚
â”‚ â€¢ Cliente recibe confirmaciÃ³n        â”‚
â”‚ â€¢ TÃ©cnico notificado                 â”‚
â”‚ â€¢ Cita lista para ejecutarse         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Estructura de Carpetas Frontend

```
web/src/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              â† Layout global
â”‚   â”œâ”€â”€ globals.css             â† Estilos globales
â”‚   â”œâ”€â”€ page.tsx                â† Landing page /
â”‚   â”‚
â”‚   â”œâ”€â”€ login/                  â† /login
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ register/               â† /register
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ profile/                â† /profile (protegida)
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                   â† /chat
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ mensajes/               â† /mensajes
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ nueva/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx        â† /mensajes/nueva
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx        â† /mensajes/:id
â”‚   â”‚
â”‚   â”œâ”€â”€ portfolio/              â† /portfolio
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx        â† /portfolio/:id
â”‚   â”‚
â”‚   â”œâ”€â”€ our-services/           â† /our-services
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ about-us/               â† /about-us
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ confirm-email/          â† /confirm-email
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ forgot-password/        â† /forgot-password
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ reset-password/         â† /reset-password
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ change-password/        â† /change-password
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â””â”€â”€ components/             â† Componentes propios de pÃ¡gina
â”‚       â”œâ”€â”€ Navbar.tsx          â† Barra de navegaciÃ³n
â”‚       â”œâ”€â”€ about-us/
â”‚       â”‚   â”œâ”€â”€ AboutUsHero.tsx
â”‚       â”‚   â”œâ”€â”€ OurTeam.tsx
â”‚       â”‚   â””â”€â”€ CallToAction.tsx
â”‚       â”œâ”€â”€ landing/
â”‚       â”‚   â”œâ”€â”€ Hero.tsx
â”‚       â”‚   â”œâ”€â”€ Services.tsx
â”‚       â”‚   â”œâ”€â”€ LatestJobs.tsx
â”‚       â”‚   â””â”€â”€ Location.tsx
â”‚       â”œâ”€â”€ chat/
â”‚       â”‚   â”œâ”€â”€ chat-message.tsx
â”‚       â”‚   â””â”€â”€ realtime-chat.tsx
â”‚       â””â”€â”€ portfolio/
â”‚           â”œâ”€â”€ PortfolioCard.tsx
â”‚           â””â”€â”€ PortfolioList.tsx
â”‚
â”œâ”€â”€ components/                 â† Componentes reutilizables
â”‚   â”œâ”€â”€ chat-message.tsx
â”‚   â”œâ”€â”€ realtime-chat.tsx
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ button.tsx
â”‚       â””â”€â”€ input.tsx
â”‚
â”œâ”€â”€ hooks/                      â† Hooks personalizados
â”‚   â”œâ”€â”€ use-chat-scroll.tsx
â”‚   â””â”€â”€ use-realtime-chat.tsx
â”‚
â””â”€â”€ lib/
    â”œâ”€â”€ client.ts               â† Cliente HTTP (fetch)
    â”œâ”€â”€ server.ts               â† Funciones servidor (RSC)
    â”œâ”€â”€ middleware.ts           â† Middleware de seguridad
    â””â”€â”€ utils.ts                â† Utilidades
```

---

## ğŸ—ï¸ Estructura de Carpetas Backend

```
backend/src/
â”‚
â”œâ”€â”€ server.ts                   â† ARCHIVO PRINCIPAL (1342 lÃ­neas)
â”‚   â”‚
â”‚   â”œâ”€â”€ Imports
â”‚   â”œâ”€â”€ ConfiguraciÃ³n Express
â”‚   â”œâ”€â”€ Middleware
â”‚   â”œâ”€â”€ Helpers (toJSONSafe, JWT)
â”‚   â”œâ”€â”€ Health check
â”‚   â”‚
â”‚   â”œâ”€â”€ USUARIOS
â”‚   â”‚   â”œâ”€â”€ GET /usuario
â”‚   â”‚   â”œâ”€â”€ POST /register
â”‚   â”‚   â”œâ”€â”€ POST /login
â”‚   â”‚   â”œâ”€â”€ GET /confirm-email
â”‚   â”‚   â”œâ”€â”€ GET /profile (protegido)
â”‚   â”‚   â”œâ”€â”€ POST /forgot-password
â”‚   â”‚   â”œâ”€â”€ POST /reset-password
â”‚   â”‚   â”œâ”€â”€ POST /change-password (protegido)
â”‚   â”‚   â””â”€â”€ GET /logout
â”‚   â”‚
â”‚   â”œâ”€â”€ CITAS
â”‚   â”‚   â”œâ”€â”€ GET /cita
â”‚   â”‚   â”œâ”€â”€ POST /cita
â”‚   â”‚   â”œâ”€â”€ GET /cita/:id
â”‚   â”‚   â”œâ”€â”€ PUT /cita/:id
â”‚   â”‚   â””â”€â”€ DELETE /cita/:id
â”‚   â”‚
â”‚   â”œâ”€â”€ SERVICIOS
â”‚   â”‚   â”œâ”€â”€ GET /servicio
â”‚   â”‚   â”œâ”€â”€ POST /servicio (admin)
â”‚   â”‚   â”œâ”€â”€ PUT /servicio/:id (admin)
â”‚   â”‚   â””â”€â”€ DELETE /servicio/:id (admin)
â”‚   â”‚
â”‚   â”œâ”€â”€ PAGOS
â”‚   â”‚   â”œâ”€â”€ GET /pago
â”‚   â”‚   â”œâ”€â”€ POST /pago
â”‚   â”‚   â”œâ”€â”€ PUT /pago/:id/validate (admin)
â”‚   â”‚   â””â”€â”€ POST /webhook/flow
â”‚   â”‚
â”‚   â”œâ”€â”€ MENSAJES
â”‚   â”‚   â”œâ”€â”€ GET /conversacion
â”‚   â”‚   â”œâ”€â”€ POST /conversacion
â”‚   â”‚   â”œâ”€â”€ POST /mensaje
â”‚   â”‚   â””â”€â”€ GET /mensaje/:conversacionId
â”‚   â”‚
â”‚   â”œâ”€â”€ JARDINES
â”‚   â”‚   â”œâ”€â”€ GET /jardin
â”‚   â”‚   â”œâ”€â”€ POST /jardin
â”‚   â”‚   â”œâ”€â”€ PUT /jardin/:id
â”‚   â”‚   â””â”€â”€ DELETE /jardin/:id
â”‚   â”‚
â”‚   â””â”€â”€ PORTAFOLIO
â”‚       â”œâ”€â”€ GET /portafolio
â”‚       â”œâ”€â”€ POST /portafolio (protegido)
â”‚       â”œâ”€â”€ PUT /portafolio/:id (protegido)
â”‚       â””â”€â”€ DELETE /portafolio/:id (protegido)
â”‚
â””â”€â”€ lib/
    â”œâ”€â”€ prisma.ts               â† Instancia Ãºnica de Prisma
    â”œâ”€â”€ mailer.ts               â† ConfiguraciÃ³n Nodemailer
    â”œâ”€â”€ middleware.ts           â† Middlewares reutilizables
    â”œâ”€â”€ server.ts               â† Utilidades servidor
    â””â”€â”€ utils.ts                â† Funciones helper
```

---

## ğŸ¯ Flujo de MensajerÃ­a en Tiempo Real

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO A autenticado      â”‚
â”‚ Abre /chat o /mensajes     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. GET /conversacion
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend retorna lista       â”‚
    â”‚ de conversaciones del user  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 2. Usuario A selecciona conversaciÃ³n
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ GET /mensaje/:conversacionId
        â”‚ Carga Ãºltimos 20 mensajesâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ 3. Usuario A escribe y envÃ­a
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ POST /mensaje      â”‚
            â”‚ {                  â”‚
            â”‚   conversacion_id  â”‚
            â”‚   cuerpo: "Hola"   â”‚
            â”‚ }                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Backend:
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ â€¢ Crea mensaje     â”‚
            â”‚ â€¢ Marca usuario A  â”‚
            â”‚   como "leÃ­do"     â”‚
            â”‚ â€¢ NOTIFICA USER B  â”‚
            â”‚   (en tiempo real) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼ (Real-time, ej: Socket.io o SSE)
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ USER B:            â”‚
            â”‚ âœ… Nuevo mensaje   â”‚
            â”‚ recibido           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Estados de Cita

```
Creada
  â”‚
  â”œâ”€â–º PENDIENTE (usuario A puede cancelar)
  â”‚     â”‚
  â”‚     â”œâ”€â–º CONFIRMADA (tÃ©cnico aceptÃ³)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º REALIZADA (se completÃ³)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º CANCELADA (durante ejecuciÃ³n)
  â”‚     â”‚
  â”‚     â””â”€â–º CANCELADA (tÃ©cnico rechazÃ³)
  â”‚
  â””â”€â–º CANCELADA (cliente cancelÃ³)
```

---

## ğŸ’¾ Estados de Pago

```
Creado
  â”‚
  â””â”€â–º PENDIENTE
       â”‚
       â”œâ”€â–º APROBADO âœ…
       â”‚
       â”œâ”€â–º RECHAZADO âŒ
       â”‚
       â”œâ”€â–º FALLIDO âŒ
       â”‚
       â””â”€â–º ANULADO âŒ
```

---

## ğŸ” Permisos por Rol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENTE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Ver perfil                                       â”‚
â”‚ âœ… Ver servicios disponibles                        â”‚
â”‚ âœ… Crear jardines                                   â”‚
â”‚ âœ… Crear citas                                      â”‚
â”‚ âœ… Pagar citas                                      â”‚
â”‚ âœ… Ver portafolio pÃºblico                           â”‚
â”‚ âœ… Chatear con tÃ©cnicos                             â”‚
â”‚ âŒ Crear servicios                                  â”‚
â”‚ âŒ Ver citas de otros clientes                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TÃ‰CNICO                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Ver perfil                                       â”‚
â”‚ âœ… Ver citas asignadas                              â”‚
â”‚ âœ… Aceptar/rechazar citas                           â”‚
â”‚ âœ… Reportar visita completada                       â”‚
â”‚ âœ… Crear portafolio                                 â”‚
â”‚ âœ… Chatear con clientes                             â”‚
â”‚ âŒ Ver citas de otros tÃ©cnicos                      â”‚
â”‚ âŒ Crear servicios                                  â”‚
â”‚ âŒ Validar pagos                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ADMINISTRADOR                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… VER TODO                                         â”‚
â”‚ âœ… Editar servicios                                 â”‚
â”‚ âœ… Validar pagos                                    â”‚
â”‚ âœ… Gestionar usuarios                               â”‚
â”‚ âœ… Ver reportes                                     â”‚
â”‚ âœ… Crear roles                                      â”‚
â”‚ âœ… Acceso a Prisma Studio                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Ciclo de Vida de un Usuario

```
1. VISITANTE
   â””â”€â–º Ve landing page
       â””â”€â–º Puede leer servicios
           â””â”€â–º Puede leer portafolio

2. SE REGISTRA
   â””â”€â–º POST /register
       â””â”€â–º Email enviado con token
           â””â”€â–º Usuario creado (activo=false)

3. CONFIRMA EMAIL
   â””â”€â–º GET /confirm-email?token=xxx
       â””â”€â–º Usuario activo=true
           â””â”€â–º Puede hacer login

4. INICIA SESIÃ“N
   â””â”€â–º POST /login
       â””â”€â–º JWT generado
           â””â”€â–º Cookie establecida
               â””â”€â–º Acceso a rutas protegidas

5. USA LA APP
   â”œâ”€â–º Como CLIENTE: Reserva citas, paga, chatea
   â”œâ”€â–º Como TÃ‰CNICO: Ve citas, reporta visitas
   â””â”€â–º Como ADMIN: Gestiona todo

6. OLVIDA CONTRASEÃ‘A
   â”œâ”€â–º POST /forgot-password
   â”œâ”€â–º Email con token
   â”œâ”€â–º POST /reset-password
   â””â”€â–º Nueva contraseÃ±a establecida

7. CAMBIA CONTRASEÃ‘A (autenticado)
   â””â”€â–º POST /change-password
       â””â”€â–º ContraseÃ±a actualizada
           â””â”€â–º Debe volver a login

8. CIERRA SESIÃ“N
   â””â”€â–º GET /logout
       â””â”€â–º Cookie eliminada
           â””â”€â–º Redirige a login
```

---

## ğŸ“± ResoluciÃ³n Responsive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js App Router                                  â”‚
â”‚ (Con Tailwind CSS)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ Mobile:      0px - 640px    (sm)                    â”‚
â”‚ Tablet:    640px - 1024px   (md, lg)                â”‚
â”‚ Desktop: 1024px+            (xl, 2xl)               â”‚
â”‚                                                     â”‚
â”‚ Todos los componentes son responsive por defecto   â”‚
â”‚ (DaisyUI + Tailwind)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**VersiÃ³n:** 1.0  
**Ãšltima actualizaciÃ³n:** 15 de Octubre 2025

